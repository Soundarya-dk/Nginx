name: CI/CD â€“ Deploy Nginx to k3s

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: self-hosted   # kubectl already installed here

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Configure kubeconfig securely
      run: |
        sudo mkdir -p $HOME/.kube
        sudo echo "${{ secrets.KUBECONFIG_DATA }}" > $HOME/.kube/config
        sudo chmod 600 $HOME/.kube/config

    - name: Apply Kubernetes manifests
      run: |
        sudo kubectl apply -f k8s/

